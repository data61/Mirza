dist: xenial

env:
  global:
    - secure: i5Aghu6hXUAGPU3oCwud6uVZJSOYUjFxc7bxG+FcdC7ALVvKEgVN2dD5Ey3kbbz0v8c2IqwwRLATjM1AJgQFZjGF0D3EHjtkYAswfFUD5VeDkaf1knKZtn3EfUy7tLx717UR9Q7AzfAL8r5OZ0KXNa0R9DIIpEXku3lKF8oc4PrxFp6btfTJixFA9LlUuNFkJbvSqtHXLct6K1flMlIoR3gWRnpf8ym3tnvI36MJWqSSFmRHkxpAi1QdxD1ZXnK3Fhb0yi6ZXYG19zZ9zuMWZVEAdiAPKNnxRDruQe0b1/2xy2KHzlQi/Gid8ypUGB/Xzj3VRd0lsnb0MtZtLWCPJCJLE6EWAE4qlY0K0MDeB5M/1juHu5uk96zbx19M3oOkO36lKLfvLcMXd18IdZd7k5PSn+RDhXbsIv0EcySzE73mWoSq+Z+ZvhSIGwRb6gVihFam952Rn1W48Gd7Gfe1i/hXCYjUJzjIZgjqLJwtuVhk/1OLUIePUX7Aw0zRzBS9xJcfrUgewxIUuv326U92b9Pely20D9gOT7qdKpdKqNvQXHbW3jQSXc94ORJ4NAf6tsdzF++RtfYqr1lXVHcgPXh0X1t689sUi1mWa9sQ9IvGrABFBa86RIx2+6NLhEUcA4OjdDkShMu/nL55UAIp40eQcZhLPCJAOY4Kq+M67yY=
    - secure: JgI35Sfn3QLy+D0sTY0Vr6txAOzFZBZzUlfzZNs/OW6OR/LYu2ah5vL+zG24lh26TAM1115X3ku7H5TEEEXiZlnz4snSnxegkL9Fr9oy2m8SVUDnniOzvOpPItk/EfKmLp2wA9x+nvmwSJFceAoe9ZTm8lBFDMVIAqmusXbvub6SNhATpJ67WtiBnPEfe5sTrzhYjmyV4TRZeCQc52stFcIoiUT5x4Bm5l0Fsv6g8cNcY4KekWIOACPG8NEJt7VXWw21+0Xm9Bua/ohRXk7n6Jg6lS6zH/wyefLuqAcgNm8MhCc2u3oyAHlzRuKNq46s49TZC4bJD8hszV6ttsDK3IuZ01hrrmRmEXDL2Gwi9Eta+mwSMqNvbX4vdRISbWRfeTrvEQruZaPeBp+K5wEYJelbnA4GpBfUC1S5/NzaJxrz5nbPJMHGMhSEb0MsdDTgWQbisijsCiZxdBVNkXFnGY5j/6bITPue91dPGMN+SH8RuOstqzLO8q09l2DVstkaTwxWWlCsu9IpIWObxW88cNJ6qdVdc+39WVzvK054HHUTjBpwOfiGX5WJ1CBxfc2I+hKHxzRZw8TOmSid5rREr26Fh1kQ0uJTwvCND0mYfKUzm+VyHz/jAGlO90O1LzoFqHGM13u+2+taHtn4aG0w/xqyrIJfXgn64je9MNal2dg=
    - DOCKER_COMPOSE_VERSION=1.23.2

language: generic

services:
  - docker

before_install:
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin

script:
  - pip install --user awscli
  - export PATH=$PATH:$HOME/.local/bin
  - eval $(aws ecr get-login --no-include-email --region ap-southeast-2)
  - docker pull 235945186688.dkr.ecr.ap-southeast-2.amazonaws.com/mirzabuild
  - docker build -f Mirza.Dockerfile --tag --target BUILD -t 235945186688.dkr.ecr.ap-southeast-2.amazonaws.com/mirzabuild --cache-from 235945186688.dkr.ecr.ap-southeast-2.amazonaws.com/mirzabuild:latest .
  - eval $(aws ecr get-login --no-include-email --region ap-southeast-2)
  - docker push 235945186688.dkr.ecr.ap-southeast-2.amazonaws.com/mirzabuild:latest
  - docker build -f Mirza.Dockerfile --target PKG-SCS -t 235945186688.dkr.ecr.ap-southeast-2.amazonaws.com/supplychainserver:$TRAVIS_COMMIT .
  - docker build -f Mirza.Dockerfile --target PKG-BR -t 235945186688.dkr.ecr.ap-southeast-2.amazonaws.com/businessregistry:$TRAVIS_COMMIT .
  - docker push 235945186688.dkr.ecr.ap-southeast-2.amazonaws.com/supplychainserver:$TRAVIS_COMMIT
  - docker push 235945186688.dkr.ecr.ap-southeast-2.amazonaws.com/businessregistry:$TRAVIS_COMMIT
